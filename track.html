<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Findero â€” Track Item</title>

  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet" />

  <style>
    body { margin:0; font-family:"Inter",sans-serif; background:#f5f7fa; }
    header { background:#dcdcdc; padding:18px 24px; display:flex; justify-content:space-between; align-items:center; box-shadow:0 4px 12px rgba(0,0,0,0.08); }
    header img { height:95px; max-width:100%; animation:fadeDown .45s ease; }
    @keyframes fadeDown { from{opacity:0; transform:translateY(-8px)} to{opacity:1; transform:translateY(0)} }

    .container { max-width:720px; margin:36px auto; padding:20px; }
    .title { text-align:center; color:#1d4ed8; font-size:28px; font-weight:700; margin-bottom:6px; }
    .subtitle { text-align:center; color:#444; margin-bottom:20px; }
    input[type="text"] { width:100%; padding:12px; border-radius:10px; border:1px solid #ccc; background:#fff; box-sizing:border-box; font-size:15px; }
    .btn { display:inline-block; margin-top:12px; padding:12px 18px; background:#ff7a00; color:#fff; border-radius:10px; font-weight:700; border:none; cursor:pointer; transition:0.18s; }
    .btn:hover { transform:scale(1.02); background:#e06d00; }
    .result, .error { margin-top:18px; padding:16px; border-radius:12px; }
    .result { background:#fff; box-shadow:0 6px 14px rgba(0,0,0,0.06); }
    .error { background:#fff6f6; border:1px solid #ffd6d6; color:#b00020; text-align:center; }
    img.item-img { max-width:220px; border-radius:8px; margin-top:10px; display:block; }
    footer { background:#1d4ed8; color:#fff; text-align:center; padding:14px; position:fixed; bottom:0; left:0; right:0; }
    .logout { background:#1d4ed8; color:#fff; border:0; padding:10px 14px; border-radius:10px; cursor:pointer; }
  </style>

  <!-- Firebase SDKs (compat) -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-storage-compat.js"></script>

  <script>
    // Your Firebase config (you already provided this)
    const firebaseConfig = {
      apiKey: "AIzaSyDL_BRheLzGxDJ-6XbjitZw8HFmUzQwgaI",
      authDomain: "findero-39098.firebaseapp.com",
      projectId: "findero-39098",
      storageBucket: "findero-39098.appspot.com",
      messagingSenderId: "796711693094",
      appId: "1:796711693094:web:616efe1fd7291759d02fe7"
    };
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();
    const storage = firebase.storage();

    // Redirect if not authenticated
    auth.onAuthStateChanged(user => {
      if (!user) window.location.href = "login.html";
    });

    function logout() {
      auth.signOut().then(()=> window.location.href = "login.html");
    }

    async function trackItem() {
      const id = document.getElementById("trackingId").value.trim();
      const out = document.getElementById("output");
      out.innerHTML = "";

      if (!id) {
        out.innerHTML = `<div class="error">Please enter a tracking ID.</div>`;
        return;
      }

      try {
        // First check foundItems
        const foundDoc = await db.collection("foundItems").doc(id).get();
        if (foundDoc.exists) {
          const d = foundDoc.data();
          out.innerHTML = renderItemCard(d, "Found Item (submitted by someone who found this)");
          return;
        }

        // Then check lostItems
        const lostDoc = await db.collection("lostItems").doc(id).get();
        if (lostDoc.exists) {
          const d = lostDoc.data();
          out.innerHTML = renderItemCard(d, "Lost Item (reported by owner)");
          return;
        }

        out.innerHTML = `<div class="error">No item found with Tracking ID <strong>${escapeHtml(id)}</strong>.</div>`;
      } catch (err) {
        out.innerHTML = `<div class="error">${escapeHtml(err.message)}</div>`;
      }
    }

    function renderItemCard(item, label) {
      // item may contain different fields; handle gracefully
      const name = item.itemName || item.itemName || "Unnamed item";
      const location = item.locationFound || item.lostLocation || item.location || "-";
      const date = item.dateFound || item.lostDate || "-";
      const desc = item.description || item.desc || "-";
      const imageUrl = item.imageUrl || "";
      const tracking = item.trackingId || item.trackingId || item.id || "";

      return `
        <div class="result">
          <div style="font-weight:700; font-size:18px; margin-bottom:6px;">${escapeHtml(name)}</div>
          <div style="color:#555">Type: ${escapeHtml(label)}</div>
          <div style="margin-top:8px">Location: <strong>${escapeHtml(location)}</strong></div>
          <div>Date: <strong>${escapeHtml(date)}</strong></div>
          <div style="margin-top:8px">Description: ${escapeHtml(desc)}</div>
          ${imageUrl ? `<img class="item-img" src="${escapeHtml(imageUrl)}" alt="item image">` : ""}
          <div style="margin-top:10px; color:#111">Tracking ID: <strong>${escapeHtml(tracking || id)}</strong></div>
        </div>
      `;
    }

    // small escape helper to avoid XSS when injecting text
    function escapeHtml(str) {
      if (!str && str !== 0) return "";
      return String(str)
        .replace(/&/g, "&amp;")
        .replace(/</g, "&lt;")
        .replace(/>/g, "&gt;")
        .replace(/"/g, "&quot;")
        .replace(/'/g, "&#039;");
    }
  </script>
</head>
<body>
  <header>
    <img src="assets/logo.png" alt="Findero Logo">
    <button class="logout" onclick="logout()">Logout</button>
  </header>

  <main class="container">
    <div class="title">Track an Item</div>
    <div class="subtitle">Enter the tracking ID provided when the item was submitted.</div>

    <input id="trackingId" type="text" placeholder="Enter tracking ID (example: AbCd123...)" />
    <div style="text-align:center">
      <button class="btn" onclick="trackItem()">Track</button>
    </div>

    <div id="output"></div>
  </main>

  <footer>&copy; 2025 Findero. All rights reserved.</footer>
</body>
</html>
